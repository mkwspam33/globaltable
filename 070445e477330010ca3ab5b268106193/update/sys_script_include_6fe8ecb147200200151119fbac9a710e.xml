<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>global.MegaphoneBroadcastInsert</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Megaphone broadcast insert from an event from HI - GLOBALGLOBAL UPDATE SET 2</description>
        <name>MegaphoneBroadcastInsert</name>
        <script><![CDATA[var MegaphoneBroadcastInsert = Class.create();
MegaphoneBroadcastInsert.prototype = {
    initialize: function() {
    },
	
	//Used by the event engine to insert a message from HI
	fromEvent: function(eventxml) {
		try{
			var xml = gs.xmlToJSON(eventxml);
			var obj = xml.sys_broadcast_message;
			var msg = new GlideRecord('sys_broadcast_message');
			msg.addQuery('dc_sys_id', obj.dc_sys_id);
			msg.query();
			var isNewMessage = !msg.hasNext();
			
			if(isNewMessage) {
				msg.initialize();
			}
			else {
				msg.next();
			}
			
			for (var field in obj){
				if (typeof obj[field] != "function"){
					if(msg.isValidField(field)) {
						var value = unescape(obj[field]);
						if(field === 'notify_users_after_date' || field === 'notify_users_until_date') {
							var gdt = new GlideDateTime(value);
							msg[field] = gdt;
						}
						else {
							msg[field] = value;
						}
					}
					else {
						gs.warn("Unknown megaphone field: " + field);
					}
				}
			}
			
			if(isNewMessage) {
				msg.insert();
			}
			else {
				msg.update();
			}
		}
		catch(ex) {
			gs.warn("Error inserting megaphone message. " + ex);
		}
	},
	
    type: 'MegaphoneBroadcastInsert'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2015-06-10 03:31:59</sys_created_on>
        <sys_id>6fe8ecb147200200151119fbac9a710e</sys_id>
        <sys_mod_count>5</sys_mod_count>
        <sys_name>MegaphoneBroadcastInsert</sys_name>
        <sys_package display_value="Broadcast Messages" source="com.snc.mega_cust">2a2f1f8344670010e8397697005557bc</sys_package>
        <sys_policy/>
        <sys_scope display_value="globaltable">070445e477330010ca3ab5b268106193</sys_scope>
        <sys_update_name>sys_script_include_6fe8ecb147200200151119fbac9a710e</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-03-24 18:33:15</sys_updated_on>
    </sys_script_include>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="globaltable">070445e477330010ca3ab5b268106193</claim_owner_scope>
        <claim_timestamp>1710dd1f44d0000001</claim_timestamp>
        <metadata_update_name>sys_script_include_6fe8ecb147200200151119fbac9a710e</metadata_update_name>
        <previous_claim_app_version>1.0.0</previous_claim_app_version>
        <previous_claim_name>globaltable</previous_claim_name>
        <previous_claim_scope>070445e477330010ca3ab5b268106193</previous_claim_scope>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-03-24 18:33:15</sys_created_on>
        <sys_id>709c32f877330010ca3ab5b268106102</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-03-24 18:33:15</sys_updated_on>
    </sys_claim>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="globaltable">070445e477330010ca3ab5b268106193</claim_owner_scope>
        <claim_timestamp>1710dd1f4440000001</claim_timestamp>
        <metadata_update_name>sys_script_include_6fe8ecb147200200151119fbac9a710e</metadata_update_name>
        <previous_claim_app_version>1.0.0</previous_claim_app_version>
        <previous_claim_name>com.snc.mega_cust</previous_claim_name>
        <previous_claim_scope>com.snc.mega_cust</previous_claim_scope>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-03-24 18:33:15</sys_created_on>
        <sys_id>b89c32f877330010ca3ab5b268106102</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-03-24 18:33:15</sys_updated_on>
    </sys_claim>
</record_update>
